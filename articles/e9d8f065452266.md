---
title: "ã€C#ã€‘WPFã®MVVMã§EventTriggerã‚’ä½¿ç”¨ã—ã¦å„ç¨®ã‚¤ãƒ™ãƒ³ãƒˆã‚’ãƒã‚¤ãƒ³ãƒ‰ã™ã‚‹"
emoji: "ğŸŒŠ"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: [csharp, WPF, MVVM]
published: true
---

# ã¯ã˜ã‚ã«

å‰å›ã®è¨˜äº‹ã§ WPF ã§ MVVM ã‚’ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ç„¡ã—ã§æ§‹ç¯‰ã—ã¦ã¿ã¾ã—ãŸã€‚
â€»ã“ã¡ã‚‰ã®è¨˜äº‹ã¯ãã®ç¶šãã«ãªã‚Šã¾ã™ã®ã§è‰¯ã‘ã‚Œã°å‚ç…§ãã ã•ã„ã€‚
https://zenn.dev/takuty/articles/b12f4011871058

æ§‹ç¯‰ã—ãŸã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã§ã¯ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨`TextBox`ã®æ–‡å­—åˆ—ãŒçµåˆã•ã‚Œã‚‹ã¨ã„ã†å‡¦ç†ã§ã—ãŸãŒã€ä»Šã®ã¾ã¾ã§ã¯ã‚¯ãƒªãƒƒã‚¯æ™‚ã®å‡¦ç†ã‚’å‡¦ç†ã—ã‹å®Ÿè£…ã™ã‚‹ã“ã¨ãŒã§ãã¾ã›ã‚“ã€‚

ãã“ã§ Microsoft ãŒå‡ºã—ã¦ã„ã‚‹**Behaviors**ã¨ã„ã†ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã§**EventTrigger**ã‚’ä½¿ç”¨ã—ã¦
ã‚¯ãƒªãƒƒã‚¯ä»¥å¤–ã®å„ç¨®ã‚¤ãƒ™ãƒ³ãƒˆã«å¯¾ã—ã¦å‡¦ç†ã‚’å®Ÿè£…ã—`ViewModel`ã¸ãƒã‚¤ãƒ³ãƒ‰ã™ã‚‹ã‚ˆã†ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’æ§‹ç¯‰ã—ã¦ã„ã“ã†ã¨æ€ã„ã¾ã™ã€‚

## ç’°å¢ƒ

- Windows10
- .NET6.0
- Visual Studio Community 2022
- WPF

# Behaviors ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

Behaviors ã‚’ Nuget ã‹ã‚‰ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ã„ãã¾ã™ã€‚
Nuget ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ã§ã€ŒBehaviorsã€ã¨æ¤œç´¢ã™ã‚‹ã¨ä¸€ç•ªä¸Šã«å‡ºã¦ãã‚‹ã®ã§ã“ã¡ã‚‰ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚
![behaviorsã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«](/images/articles/behaviorsInstall.png)

ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«å®Œäº†å¾Œã€`Bihaviors`ã‚’`View`ã§ä½¿ç”¨ã—ã¦ã„ããŸã„ã®ã§å‚ç…§ã‚’è¿½åŠ ã—ã¾ã™ã€‚ã“ã“ã§ã¯ MainWindow.xaml ä¸Šéƒ¨ã«`xmlns:i="http://schemas.microsoft.com/xaml/behaviors"`ã‚’è¿½åŠ ã—ã¾ã—ãŸã€‚

```xml:MainWindow.xaml
<Window x:Class="WpfApp1.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:WpfApp1"
        xmlns:vm="clr-namespace:WpfApp1.ViewModel"
        xmlns:i="http://schemas.microsoft.com/xaml/behaviors"
        mc:Ignorable="d"
        Title="MainWindow" Height="450" Width="490">
```

# EventTrigger å®Ÿè£…

EventTrigger ã‚’ä½¿ç”¨ã™ã‚‹æº–å‚™ãŒã§ããŸã®ã§ã€å„ç¨®ã‚¤ãƒ™ãƒ³ãƒˆã‚’å®Ÿè£…ã—ã¦ã„ãã®ã§ã™ãŒ
ä»Šå›ã¯ã€

- Window ãƒ­ãƒ¼ãƒ‰å¾Œã«åˆ¥ Window ã‚’é–‹ã
- ComboBox ã®é¸æŠã‚’å¤‰æ›´ã™ã‚‹ã¨é¸æŠã—ãŸå€¤ãŒ TextBlock ã«è¡¨ç¤ºã•ã‚Œã‚‹

ã® 2 ç‚¹ã‚’å®Ÿè£…ã—ãŸã„ã¨æ€ã„ã¾ã™ã€‚

## Window ãƒ­ãƒ¼ãƒ‰å¾Œã«åˆ¥ Window ã‚’é–‹ã

ãƒ­ãƒ¼ãƒ‰å¾Œã« Command ã‚’å®Ÿè¡Œã™ã‚‹ã«ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«è¨˜è¿°ã—ã¾ã™ã€‚

```xml:MainWindow.xaml
<i:Interaction.Triggers>
    <i:EventTrigger EventName="Loaded">
        <i:InvokeCommandAction Command="{Binding LoadedCommand}" />
    </i:EventTrigger>
</i:Interaction.Triggers>
```

ã“ã‚Œã§`MainWindow`ã®`Loaded`ã‚¤ãƒ™ãƒ³ãƒˆã«å¯¾ã—ã¦`LoadedCommand`ã‚’å®Ÿæ–½ã™ã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

LoadedCommand ã®å®Ÿè£…å†…å®¹ã¯ä»¥ä¸‹ã®ã‚ˆã†ãªæ„Ÿã˜ã§ã™ã€‚

```csharp
using System;
using System.Windows.Input;
using WpfApp1.ViewModel;

namespace WpfApp1
{
    public class LoadedCommand : ICommand
    {
        MainWindowViewModel m_vm;
        public LoadedCommand(MainWindowViewModel vm)
        {
            m_vm = vm;
        }

        public event EventHandler? CanExecuteChanged
        {
            add { CommandManager.RequerySuggested += value; }
            remove { CommandManager.RequerySuggested -= value; }
        }

        /// <summary>
        /// ã‚³ãƒãƒ³ãƒ‰ãŒåˆ©ç”¨å¯èƒ½ã‹ã©ã†ã‹
        /// </summary>
        /// <param name="parameter"></param>
        /// <returns></returns>
        /// <exception cref="NotImplementedException"></exception>
        public bool CanExecute(object? parameter)
        {
            return true;
        }


        /// <summary>
        /// å®Ÿè¡Œæ™‚ã®å‡¦ç†
        /// </summary>
        /// <param name="parameter"></param>
        /// <exception cref="NotImplementedException"></exception>
        public void Execute(object? parameter)
        {
            var dlg = new LoadedWindow();
            dlg.ShowDialog();
        }
    }
}
```

ã“ã‚Œã‚’`ViewModel`ã§ãƒã‚¤ãƒ³ãƒ‰ã™ã‚‹ã“ã¨ã§`MainWindow`ãŒãƒ­ãƒ¼ãƒ‰å¾Œã«`Excute`ãŒèµ°ã‚Šã€åˆ¥ Window ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

## ComboBox ã®é¸æŠã‚’å¤‰æ›´ã™ã‚‹ã¨é¸æŠã—ãŸå€¤ãŒè¡¨ç¤ºã•ã‚Œã‚‹

ã“ã¡ã‚‰ã§ã¯ã¾ãš`MainWindow`ã®`View`ã§`ComboBox`ã‚’ä»¥ä¸‹ã®ã‚ˆã†ã«ä½œæˆã—ã¾ã™ã€‚

```xml:MainWindow.xaml
<ComboBox
    HorizontalAlignment="Left"
    VerticalAlignment="Top"
    VerticalContentAlignment="Center"
    Height="25"
    Width="170"
    Margin="150,400,0,0"
    SelectedItem="{Binding SelectedItem}">
    <ComboBoxItem Content="ã¶ã©ã†" />
    <ComboBoxItem Content="ã‚Šã‚“ã”" />
    <ComboBoxItem Content="ã¿ã‹ã‚“" />
    <ComboBoxItem Content="ã‚‚ã‚‚" />
    <i:Interaction.Triggers>
        <i:EventTrigger EventName="SelectionChanged">
            <i:InvokeCommandAction Command="{Binding SelectionChangedCommand}" />
        </i:EventTrigger>
    </i:Interaction.Triggers>
</ComboBox>
```

`ComboBox`ã®é¸æŠå¤‰æ›´å¾Œã«å‡¦ç†ã‚’èµ°ã‚‰ã›ãŸã„ã®ã§`SelectionChanged`ã«å¯¾ã—ã¦`EventTrigger`ã‚’è¨­å®šã—ã¾ã™ã€‚
ã¾ãŸã€é¸æŠã—ãŸå€¤ã‚‚å–å¾—ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã®ã§`SelectedItem`ã‚’`ViewMode`ã¸ãƒã‚¤ãƒ³ãƒ‰ã—ã¦ã„ã¾ã™ã€‚

SelectionChangedCommand ã®å®Ÿè£…å†…å®¹ã¯ä»¥ä¸‹ã®ã‚ˆã†ãªæ„Ÿã˜ã§ã™ã€‚

```csharp
using System;
using System.Windows.Input;
using WpfApp1.ViewModel;

namespace WpfApp1
{
    public class SelectionChangedCommand : ICommand
    {
        MainWindowViewModel m_vm;
        public SelectionChangedCommand(MainWindowViewModel vm)
        {
            m_vm = vm;
        }

        public event EventHandler? CanExecuteChanged
        {
            add { CommandManager.RequerySuggested += value; }
            remove { CommandManager.RequerySuggested -= value; }
        }

        /// <summary>
        /// ã‚³ãƒãƒ³ãƒ‰ãŒåˆ©ç”¨å¯èƒ½ã‹ã©ã†ã‹
        /// </summary>
        /// <param name="parameter"></param>
        /// <returns></returns>
        /// <exception cref="NotImplementedException"></exception>
        public bool CanExecute(object? parameter)
        {
            return m_vm.SelectedItem != null;
        }

        /// <summary>
        /// å®Ÿè¡Œæ™‚ã®å‡¦ç†
        /// </summary>
        /// <param name="parameter"></param>
        /// <exception cref="NotImplementedException"></exception>
        public void Execute(object? parameter)
        {
            object content = m_vm.SelectedItem.Content;
            if (content != null)
            {
                m_vm.ResultValue = content.ToString();
            }
        }
    }
}
```

ã“ã‚Œã§`SelectedItem`ã®å€¤ã‚’`TextBlock`ã¸è¡¨ç¤ºã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

# å®Ÿè£…å¾Œå‹•ä½œ

## ç”»é¢ãƒ­ãƒ¼ãƒ‰å®Œäº†å¾Œ

`MainWindow`ãŒèµ·å‹•ã™ã‚‹ã¨è‡ªå‹•çš„ã«åˆ¥ Window ãŒè¡¨ç¤ºã•ã‚Œã¾ã—ãŸã€‚
`EventTrigger`ã§`Loaded`ã‚¤ãƒ™ãƒ³ãƒˆãŒèµ°ã£ã¦ã„ã‚‹ã“ã¨ãŒç¢ºèªã§ãã¾ã™ã€‚
![ç”»é¢ãƒ­ãƒ¼ãƒ‰å®Œäº†å¾Œ](/images/articles/MainWindow_After_Load.png)

## ComboBox é¸æŠå¤‰æ›´

ã¯ã˜ã‚ã¯`ComboBox`ã¯ä½•ã‚‚é¸æŠã•ã‚Œã¦ãŠã‚‰ãš`TextBlock`ã‚‚ç©ºç™½ã§ã™ã€‚
![ComboBoxå¤‰æ›´å‰](/images/articles/MainWindow_Before_SelectionChanged.png)

`ComboBox`ã§ã€Œã¶ã©ã†ã€ã‚’é¸æŠã—ã¦ã¿ã¾ã™ã€‚
![ComboBoxã¶ã©ã†å¤‰æ›´å¾Œ](/images/articles/MainWindow_After_SelectionChanged_Grape.png)

`TextBlock`ã«ã€Œã¶ã©ã†ã€ãŒè¡¨ç¤ºã•ã‚ŒãŸã®ã§æ¬¡ã«ã€Œã¿ã‹ã‚“ã€ã‚’é¸æŠã—ã¦ã¿ã¾ã™ã€‚
![ComboBoxã¿ã‹ã‚“å¤‰æ›´å¾Œ](/images/articles/MainWindow_After_SelectionChanged_Orange.png)

`TextBlock`ã®å€¤ãŒã€Œã¿ã‹ã‚“ã€ã«å¤‰æ›´ã•ã‚Œã¾ã—ãŸã€‚ã“ã‚Œã§`EventTrigger`ã§`Loaded`ã‚¤ãƒ™ãƒ³ãƒˆãŒèµ°ã£ã¦ã„ã‚‹ã“ã¨ãŒç¢ºèªã§ãã¾ã—ãŸã€‚

## ã¾ã¨ã‚

ä»Šå›ã¯ WPF ã® MVVM ã§å„ç¨®ã‚¤ãƒ™ãƒ³ãƒˆã‚’`EventTrigger`ã§å‡¦ç†ã™ã‚‹æ–¹æ³•ã‚’ãŠä¼ãˆã—ã¾ã—ãŸã€‚
ã“ã“ã¾ã§ã§ãã‚Œã°ç°¡å˜ãªã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã§ã‚ã‚Œã°å®Ÿè£…ã§ãã¾ã™ãŒã€é«˜åº¦ãªã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ MVVM ã§ã‚„ã‚ã†ã¨ã™ã‚‹ã¨ã‹ãªã‚Šé›£ã—ã„ã®ã§ã€ãã®æ™‚ãŒãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã®ä½¿ã„æ™‚ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚
æ¬¡å›ä»¥é™ã€MVVM ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã‚‚æ©Ÿä¼šãŒã‚ã‚Œã°ç´¹ä»‹ã—ã¦ã„ããŸã„ã¨æ€ã„ã¾ã™ã€‚

# å‚è€ƒè³‡æ–™

https://qiita.com/tera1707/items/7ecde6e97a19437cbf72
